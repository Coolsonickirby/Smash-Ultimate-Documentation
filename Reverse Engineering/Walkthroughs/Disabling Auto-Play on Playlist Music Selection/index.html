
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../../GDB/">
      
      
      
      <link rel="icon" href="../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.5.2, mkdocs-material-9.2.5">
    
    
      
        <title>Disabling Auto-Play on Playlist Music Selection - Super Smash Bros. Ultimate Modding Documentation</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.0e669242.min.css">
      
        
        <link rel="stylesheet" href="../../../assets/stylesheets/palette.85d0ee34.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="slate" data-md-color-primary="deep-purple" data-md-color-accent="amber">
  
    
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#disabling-auto-play-on-playlist-music-selection" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../.." title="Super Smash Bros. Ultimate Modding Documentation" class="md-header__button md-logo" aria-label="Super Smash Bros. Ultimate Modding Documentation" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Super Smash Bros. Ultimate Modding Documentation
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Disabling Auto-Play on Playlist Music Selection
            
          </span>
        </div>
      </div>
    </div>
    
      
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../.." title="Super Smash Bros. Ultimate Modding Documentation" class="md-nav__button md-logo" aria-label="Super Smash Bros. Ultimate Modding Documentation" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    Super Smash Bros. Ultimate Modding Documentation
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
    <li class="md-nav__item">
      <a href="../../.." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Introduction
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Prerequisites
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Prerequisites
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../Prerequisites/Modding%20Setup/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Modding Setup
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../Prerequisites/Dumping%20the%20data.arc/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Dumping the data.arc
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
    <li class="md-nav__item">
      <a href="../../../File%20Formats/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    File Formats
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
        
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Modding
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Modding
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../Modding/Audio/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Audio
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../Modding/Textures/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Textures
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
        
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Skyline
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            Skyline
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../Skyline/What%20is%20Skyline/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    What is Skyline
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../Skyline/Setting%20up%20the%20Skyline%20Development%20Environment/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Setting up the Skyline Development Environment
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6" checked>
        
          <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Reverse Engineering
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            Reverse Engineering
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../Ghidra/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Ghidra Setup
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../GDB/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    GDB Setup
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6_3" checked>
        
          <label class="md-nav__link" for="__nav_6_3" id="__nav_6_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Walkthroughs
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_6_3_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_6_3">
            <span class="md-nav__icon md-icon"></span>
            Walkthroughs
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    Disabling Auto-Play on Playlist Music Selection
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    Disabling Auto-Play on Playlist Music Selection
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#things-well-cover" class="md-nav__link">
    Things we'll cover
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#the-start" class="md-nav__link">
    The start
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#breaking" class="md-nav__link">
    Breaking
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tracking" class="md-nav__link">
    Tracking
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#noping" class="md-nav__link">
    Noping
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#converting-into-a-skyline-plugin" class="md-nav__link">
    Converting into a Skyline Plugin
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#conclusion" class="md-nav__link">
    Conclusion
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#things-well-cover" class="md-nav__link">
    Things we'll cover
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#the-start" class="md-nav__link">
    The start
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#breaking" class="md-nav__link">
    Breaking
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tracking" class="md-nav__link">
    Tracking
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#noping" class="md-nav__link">
    Noping
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#converting-into-a-skyline-plugin" class="md-nav__link">
    Converting into a Skyline Plugin
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#conclusion" class="md-nav__link">
    Conclusion
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


<div><h1 id="disabling-auto-play-on-playlist-music-selection">Disabling Auto-Play on Playlist Music Selection</h1>
<p>This walkthrough will explain the process of using the shared Smash Ultimate Research Server to disable and prevent the music from being played after selecting a track in the normal playlist menu.</p>
<h2 id="things-well-cover">Things we'll cover</h2>
<ul>
<li>Using Ghidra and the shared Smash Ultimate Research Server to find useful functions</li>
<li>Using GDB to break at said functions and view backtraces</li>
<li>Track down the instruction which calls the function to play the music after selecting it</li>
<li><code>nop</code>ing said instruction to prevent the song from playing after selecting it</li>
<li>Creating a skyline plugin with our research to automatically preform the patch for us</li>
</ul>
<p>Let's get started!</p>
<h2 id="the-start">The start</h2>
<p>So first things first, lets go ahead and open up the main decompiled code in Ghidra from the shared Smash Ultimate Research Server.
<img alt="Inital screen of Ghidra" src="../../../img/Walkthroughs/Disabling%20Auto-Play%20on%20Playlist%20Music%20Selection/pic_1.png"></p>
<p>Let's go ahead and search in the symbol tree for anything that might be related to music and see if we get any hits. I'll use <code>bgm</code> since that's something commonly associated with music.
<img alt="Search results of 'bgm'" src="../../../img/Walkthroughs/Disabling%20Auto-Play%20on%20Playlist%20Music%20Selection/pic_2.gif"></p>
<p>Hooo boy! That's a lotta stuff! Luckily for us though, we can ignore everything in the <code>Exports</code> since those are only accessed by the lua files. We have some functions with the label <code>FUN_</code>, so we'll ignore all of those until we're desperate. There are some functions inside namespaces, which from my expierence don't matter much. There are also a couple of labels, but those are for the game's reference. So now we're left with the following functions:</p>
<ul>
<li><code>bgm_related</code></li>
<li><code>get_bgm_save_no</code></li>
<li><code>get_ui_bgm_entry_idx_by_id</code></li>
<li><code>play_bgm_by_prc_entry_index</code></li>
</ul>
<p><code>bgm_related</code> and <code>get_bgm_save_no</code> are out of it for me, since the first one is still not exactly known while the other is clearly known for something unrelated to our mission. So now we only have two.</p>
<p>I'll personally decide to go with <code>play_bgm_by_prc_entry_index</code>, since that function sounds like it's in charge of playing the bgms.</p>
<p>Now that we decided on the function, we'll need to get it's offset. To do so, we'll click on the function in the <code>Symbol Tree</code> and look at the first offset after the function declaration.
<img alt="Offset for the function after the declaration" src="../../../img/Walkthroughs/Disabling%20Auto-Play%20on%20Playlist%20Music%20Selection/pic_3.png">
As we can see here, the offset is <code>71033135f0</code>. However, we need to remove the <code>710</code> prefix and put a <code>0x</code> prefix instead because <code>710</code> is the base address in Ghidra. So the offset we'll use in Rust and GDB will be <code>0x33135f0</code></p>
<h2 id="breaking">Breaking</h2>
<p>We have our offset, so now we can start having the real fun ðŸ˜ˆ! We'll go ahead and start GDB in Debian and <code>Super Smash Bros. Ultimate</code> on the switch. Once GDB attaches and finds main, we can run <code>break_at 0x33135f0</code> to set a breakpoint at the function we found. That means everytime that function runs, the game will pause and we can see what's going on in memory.
<img alt="Running gdb-multiarch and entering 'break_at 0x33135f0'" src="../../../img/Walkthroughs/Disabling%20Auto-Play%20on%20Playlist%20Music%20Selection/pic_4.png"></p>
<p>Let's go ahead and enter <code>c</code>, then get to the Stage Selection Screen and open up a playlist. When we trying playing a song with the <code>Y</code> button, the game freezes! Don't worry though, your game didn't crash. GDB stopped the game and now you can run commands in GDB.
<img alt="GDB breaking on a function" src="../../../img/Walkthroughs/Disabling%20Auto-Play%20on%20Playlist%20Music%20Selection/pic_5.png"></p>
<p>We can enter our commands into GDB, we'll run the <code>print_trace</code> command to get the current $pc (pc being the current offset we're at in the code), the $lr (lr being the instruction that we'll jump back to after our function is over), and the backtrace (a list keeping track of which offset to jump back to).
<img alt="'print_trace' command being run on manually played back song" src="../../../img/Walkthroughs/Disabling%20Auto-Play%20on%20Playlist%20Music%20Selection/pic_6.png"></p>
<p>Keeping a note of this output in case we need to compare it to another scenario will be extremely helpful the more deeper you dive into reversing.</p>
<p>We'll continue (type <code>c</code> and hit enter) and try to select a song by choosing it this time. When we press <code>A</code> to choose the game, the game freezes again! Just like before, the function got called, so let's go ahead and run the <code>print_trace</code> command again.
<img alt="'print_trace' command being run on chosen song" src="../../../img/Walkthroughs/Disabling%20Auto-Play%20on%20Playlist%20Music%20Selection/pic_7.png"></p>
<p>Oho? What's this? The second offset in the chosen song playback is different than the second offset in the manually chosen playback. This means that if we modify anything in the first offset, then it'll affect both, manually playing the song and the game automatically playing the song. That's pretty interesting. Let's go ahead and jump to the second offset in the chosen song playback in Ghidra since that's what we want to prevent.</p>
<h2 id="tracking">Tracking</h2>
<p>We can press <code>g</code> in Ghidra to jump to an offset. Although when we jump to an offset, we need to add <code>710</code> before the offset, since Ghidra starts at <code>710</code> (so in our case, we'll be jumping to <code>7101b352ac</code> in Ghidra)
<img alt="Jumping to 7101b352ac in Ghidra" src="../../../img/Walkthroughs/Disabling%20Auto-Play%20on%20Playlist%20Music%20Selection/pic_8.png">
(Please ignore the horrible hard to read text on the right, that's just a side-effect with the Dark Mode Ghidra theme lol)</p>
<p>If we look closely, we can see that we landed at the instruction right after a <code>bl</code> (branch link), which is how aarch64 calls functions. If we double click the function, we can see that it calls <code>play_bgm_by_prc_entry_index</code> in it
<img alt="Going inside the unknown function" src="../../../img/Walkthroughs/Disabling%20Auto-Play%20on%20Playlist%20Music%20Selection/pic_9.png"></p>
<h2 id="noping">Noping</h2>
<p>So now that we know that function calls another function that runs the <code>play_bgm_by_prc_entry_index</code>, lets change the <code>bl</code> instruction to a <code>nop</code>. Since I didn't explain it earlier, a <code>nop</code> is a instruction that does absolutely nothing, and that's what makes it special. So let's say that we don't want the <code>bl</code> instruction to jump to a different function. All we need to do is replace the <code>bl</code> instruction with a <code>nop</code> instruction and mission accomplished! To replace the instruction with a nop, we just need to copy the offset of the <code>bl</code> instruction (<code>7101b352a8</code> -&gt; <code>0x1b352a8</code>) and use the <code>no_op</code> function we have in GDB.
(If you accidentally continued, then you can freeze the game at any moment by pressing <code>Ctrl + C</code>)
<img alt="noping the function in GDB" src="../../../img/Walkthroughs/Disabling%20Auto-Play%20on%20Playlist%20Music%20Selection/pic_10.png"></p>
<p>Now whenever the game hits the code to jump to the other function, instead it'll see a <code>nop</code>, then it'll think it has to do nothing and keep going, which means the function to play the music will be skipped. Let's continue the game and see what happens when we try playing a song.
<div class="video-container"><video style="position:relative;width:100%;height:22.172vw" controls alt="type:video"><source src="../../../img/Walkthroughs/Disabling%20Auto-Play%20on%20Playlist%20Music%20Selection/success.mp4" type="video/mp4"></source></video></div></p>
<p>Success! Congratulations! You have successfully reversed and patched the game to not auto-play the music on selection in the playlist menu!</p>
<h2 id="converting-into-a-skyline-plugin">Converting into a Skyline Plugin</h2>
<p>We have our newfound knowledge on how to prevent the game from automatically playing the music when we pick a song, but now we have to manually no_op the function every time we want the game to not play the song. If we want to distribute this as a mod so that users can enjoy it, we can't expect them to have GDB and be willing to put up with manually noping the instruction themselves every time. That's where skyline plugins come in! We'll create a sklyine plugin that patches the offset with a <code>nop</code> instruction every time the game boots!</p>
<p>So first, we'll run the <code>cargo skyline new &lt;project_name&gt;</code> command to make a new skyline project. Then open up that folder with your favorite IDE (I'll be using VSCode).</p>
<p>Go to <code>src/lib.rs</code> and remove the <code>println!(...)</code> line from the main function. Now make a new line in <code>main()</code> and write the following:
<code>skyline::patching::Patch::in_text(0x1b352a8).nop().expect("Failed to patch 0x1b352a8")</code>
This line basically says "Hey, go to the .text section (where the code is stored), then jump to the offset given (<code>0x1b352a8</code>, which is what we noped), then nop. If you fail to nop it, then throw an error message!". Now we can run <code>cargo skyline run</code> and test it out in-game! </p>
<h2 id="conclusion">Conclusion</h2>
<p>I'd say we cleared all of our goals in this walkthrough! We used the Shared Research Server to track down a promising function, used GDB to break and inspect the stack trace, tracked down the instruction which jumped to the function that called the <code>play_bgm</code> function, noped said instruction, and converted it to a skyline plugin.</p></div>





                
              </article>
            </div>
          
          
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "../../..", "features": [], "search": "../../../assets/javascripts/workers/search.dfff1995.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../../assets/javascripts/bundle.78eede0e.min.js"></script>
      
    
  </body>
</html>